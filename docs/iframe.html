<html>

<head>
    <script src="./broadcast-channel.browserify.js"></script>
</head>

<body id="body">
</body>

<script>
    window.addEventListener('storage', () => {
        // window.localStorage.setItem('pubkey.broadcast-channel-0-foobar', 'aaa')
        console.log('iframe recieved storage-event');
    });

    const channel = new window.BroadcastChannel2('foobar');
    channel.onmessage = function(msg) {
        console.log('recieved message');

        const body = document.getElementById('body');
        body.innerHTML += JSON.stringify(msg) + '</br>';

        channel.postMessage({
            answer: true,
            original: msg
        });
    };
</script>

</html>

<html>

<head>
    <script src="./broadcast-channel.browserify.js"></script>
</head>

<body id="body">

    <iframe src="./iframe.html" style="width: 200px; height: 200px; background-color: white;"></iframe>
</body>


<script>
    var body = document.getElementById('body');
    var channel = new window.BroadcastChannel2('foobar');
    var messages = [];
    channel.onmessage = function(msg) {
        console.log('got answer');
        console.dir(msg);
        messages.push(msg);

        if (msg.original && msg.original.step === 'one') {
            channel.postMessage({
                step: 'two'
            });
        }

        // check if sucess
        if (messages.length === 2) {
            console.log('sucess');
            body.style.backgroundColor = 'green';
        }
    };
    setTimeout(function() {
        // send to iframe and await answer
        console.log('sending message via ' + channel.type);
        channel.postMessage({
            step: 'one'
        });
        console.log('message send');

    }, 1000);
</script>

</html>
